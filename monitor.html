<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cacao Drying Monitor</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#40c057"/>
  <link rel="manifest" href="manifest.json">
  <style>
    :root{
      --bg:#fff; --muted:#666; --accent:#40c057; --panel:#f9f9f9; --sidebar:#f5f5f5;
      --max-width:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui;background:var(--bg);color:#000}
    .app{display:flex;min-height:100vh;max-width:var(--max-width);margin:0 auto}
    /* Sidebar / nav */
    .sidebar{width:220px;background:var(--sidebar);padding-top:1rem;border-right:1px solid #e6e6e6;display:flex;flex-direction:column;align-items:flex-start;gap:0.2rem;position:sticky;top:0;height:100vh}
    .nav-btn{width:100%;padding:0.9rem 1rem;text-decoration:none;color:#333;display:flex;gap:12px;align-items:center;cursor:pointer;border-left:4px solid transparent}
    .nav-btn.active{background:#e9f7ee;border-left-color:var(--accent);color:#000;font-weight:600}
    .nav-btn:hover{background:#eee}
    .logout{margin-top:auto;padding:1rem;width:100%;color:#b00020;border-top:1px solid #e6e6e6;cursor:pointer}
    /* Main area */
    .main{flex:1;padding:1.2rem;min-height:100vh;display:flex;flex-direction:column}
    header{background:radial-gradient(circle at center,#fff,#a2d2ff,#b5ead7);padding:1rem;border-radius:10px;text-align:center;font-weight:700;margin-bottom:1rem}
    #content{flex:1;background:var(--panel);padding:1rem;border-radius:10px;overflow:auto;box-shadow:0 2px 12px rgba(0,0,0,0.06)}
    footer{text-align:center;color:var(--muted);margin-top:1rem}
    /* mobile bottom nav */
    .bottom-nav{display:none;position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #ddd;display:flex;justify-content:space-around;padding:.4rem 0}
    .bottom-nav button{background:none;border:none;padding:.6rem .8rem;border-radius:8px;cursor:pointer;font-weight:600}
    .bottom-nav button.active{color:var(--accent)}
    /* responsive */
    @media (max-width:900px){
      .app{flex-direction:column}
      .sidebar{width:100%;height:auto;position:relative;flex-direction:row;justify-content:space-around;border-right:none;border-bottom:1px solid #e6e6e6;padding:0.4rem 0}
      .main{padding:0.9rem}
      .bottom-nav{display:flex}
    }
    /* small utility */
    .loading{text-align:center;padding:3rem;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app" role="application">
    <nav class="sidebar" aria-label="Primary">
      <a class="nav-btn active" data-page="dashboard.html">üìä Dashboard</a>
      <a class="nav-btn" data-page="overview.html">üìÑ Overview</a>
      <a class="nav-btn" data-page="data-summary.html">üìÅ Data Summary</a>
      <div class="logout" id="logoutBtn">üö™ Logout</div>
    </nav>

    <main class="main">
      <header>Development and Implementation of a Wireless Monitoring System for Theobroma Cacao Drying Process</header>

      <div id="content" aria-live="polite">
        <div class="loading">Loading content...</div>
      </div>

      <footer>&copy; <span id="y"></span> Cacao Drying Monitoring ‚Ä¢ Powered by ThingSpeak</footer>
    </main>
  </div>

  <!-- bottom nav (mobile) -->
  <div class="bottom-nav" role="toolbar" aria-label="Mobile navigation">
    <button data-page="dashboard.html" class="active">Dashboard</button>
    <button data-page="overview.html">Overview</button>
    <button data-page="data-summary.html">Data</button>
  </div>

  <div id="toast" style="display:none;position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#222;color:#fff;padding:.6rem 1rem;border-radius:10px;z-index:9999"></div>

  <script>
    // Toast
    function toast(msg, t=2000){ const s = document.getElementById('toast'); s.textContent=msg; s.style.display='block'; clearTimeout(s._h); s._h=setTimeout(()=>s.style.display='none',t); }

    // Session validation
    function sessionValid(){
      try{
        const s = JSON.parse(localStorage.getItem('cacao_session')||'null');
        return s && s.expires > Date.now();
      }catch{return false;}
    }
    if(!sessionValid()){ localStorage.removeItem('cacao_session'); window.location.href='index.html' }

    // Extend session on activity and auto-logout when expired
    function extendSession(){ try{ const s=JSON.parse(localStorage.getItem('cacao_session')); if(s){ s.expires = Date.now() + (30*60*1000); localStorage.setItem('cacao_session', JSON.stringify(s)); } }catch(e){} }
    let logoutTimer;
    function startAutoLogout(){ clearTimeout(logoutTimer); logoutTimer = setTimeout(()=>{ toast('Session expired'); localStorage.removeItem('cacao_session'); setTimeout(()=>location.href='index.html',800); }, 30*60*1000); }
    ['mousemove','keydown','click','touchstart'].forEach(e=>document.addEventListener(e, ()=>{ extendSession(); startAutoLogout(); }));
    startAutoLogout();

    // Dynamic page loader
    const content = document.getElementById('content');
    async function loadPage(page){
      content.innerHTML = '<div class="loading">Loading...</div>';
      try{
        const res = await fetch(page);
        if(!res.ok) throw new Error('Not found');
        const txt = await res.text();
        content.innerHTML = txt;
      }catch(e){
        content.innerHTML = `<div style="padding:2rem;color:#b00020;text-align:center">Failed to load ${page}</div>`;
      }
    }

    // nav handling
    const navs = document.querySelectorAll('.nav-btn');
    navs.forEach(n=>{
      n.addEventListener('click', ()=>{
        navs.forEach(x=>x.classList.remove('active'));
        n.classList.add('active');
        loadPage(n.dataset.page);
      });
    });
    // bottom nav
    document.querySelectorAll('.bottom-nav button').forEach(b=>{
      b.addEventListener('click', ()=>{
        document.querySelectorAll('.bottom-nav button').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        // also activate sidebar links
        navs.forEach(x=>{ x.classList.toggle('active', x.dataset.page === b.dataset.page) });
        loadPage(b.dataset.page);
        window.scrollTo({top:0,behavior:'smooth'});
      });
    });

    // default page
    loadPage('dashboard.html');

    // logout
    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem('cacao_session');
      toast('Logged out');
      setTimeout(()=> location.href = 'index.html', 700);
    });

    // footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Register service worker for PWA
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js').then(()=>console.log('SW registered')).catch(()=>console.log('SW failed'));
    }
  </script>
</body>
</html>
