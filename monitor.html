<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cacao Drying Monitor</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#40c057"/>
  <link rel="manifest" href="manifest.json">
  <style>
    :root{
      --bg:#fff; --muted:#666; --accent:#40c057; --panel:#f9f9f9;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui;background:var(--bg);color:#000}
    body{display:flex;flex-direction:column;min-height:100vh}
    header{
      background:radial-gradient(circle at center,#fff,#a2d2ff,#b5ead7);
      padding:1.2rem;
      border-radius:0 0 12px 12px;
      text-align:center;
      font-weight:700;
      font-size:1.1rem;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    main{
      flex:1;
      padding:1rem;
      display:flex;
      flex-direction:column;
    }
    #content{
      flex:1;
      background:var(--panel);
      padding:1rem;
      border-radius:10px;
      overflow:auto;
      box-shadow:0 2px 12px rgba(0,0,0,0.06);
    }
    footer{
      background:#fff;
      border-top:1px solid #ddd;
      padding:.6rem 1rem;
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:.5rem;
    }
    .bottom-nav{
      display:flex;
      justify-content:center;
      gap:1.2rem;
      flex-wrap:wrap;
    }
    .bottom-nav button{
      background:none;
      border:none;
      color:#333;
      font-weight:600;
      cursor:pointer;
      padding:.5rem .8rem;
      border-radius:8px;
      transition:background .2s;
    }
    .bottom-nav button.active{
      color:var(--accent);
      background:#e9f7ee;
    }
    #logoutBtn{
      background:linear-gradient(90deg,#fa5252,#e03131);
      color:#fff;
      border:none;
      border-radius:8px;
      padding:.5rem 1rem;
      font-weight:600;
      cursor:pointer;
      width:fit-content;
      margin:0 auto .3rem;
    }
    #logoutBtn:hover{opacity:.9}
    .loading{text-align:center;padding:3rem;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    Development and Implementation of a Wireless Monitoring System for Theobroma Cacao Drying Process
  </header>

  <main>
    <div id="content" aria-live="polite">
      <div class="loading">Loading content...</div>
    </div>
  </main>

  <footer>
    <div class="bottom-nav" role="toolbar" aria-label="Navigation">
      <button data-page="dashboard.html" class="active">Dashboard</button>
      <button data-page="overview.html">Overview</button>
      <button data-page="data-summary.html">Data</button>
    </div>
    <button id="logoutBtn">Logout</button>
    <div style="font-size:.9rem;color:#666">&copy; <span id="y"></span> Cacao Drying Monitoring â€¢ Powered by ThingSpeak</div>
  </footer>

  <div id="toast" style="display:none;position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#222;color:#fff;padding:.6rem 1rem;border-radius:10px;z-index:9999"></div>

  <script>
    // Toast
    function toast(msg, t=2000){
      const s = document.getElementById('toast');
      s.textContent=msg;
      s.style.display='block';
      clearTimeout(s._h);
      s._h=setTimeout(()=>s.style.display='none',t);
    }

    // Session validation
    function sessionValid(){
      try{
        const s = JSON.parse(localStorage.getItem('cacao_session')||'null');
        return s && s.expires > Date.now();
      }catch{return false;}
    }
    if(!sessionValid()){ localStorage.removeItem('cacao_session'); window.location.href='index.html'; }

    // Extend session
    function extendSession(){
      try{
        const s=JSON.parse(localStorage.getItem('cacao_session'));
        if(s){ s.expires = Date.now() + (30*60*1000); localStorage.setItem('cacao_session', JSON.stringify(s)); }
      }catch(e){}
    }
    let logoutTimer;
    function startAutoLogout(){
      clearTimeout(logoutTimer);
      logoutTimer = setTimeout(()=>{
        toast('Session expired');
        localStorage.removeItem('cacao_session');
        setTimeout(()=>location.href='index.html',800);
      }, 30*60*1000);
    }
    ['mousemove','keydown','click','touchstart'].forEach(e=>document.addEventListener(e, ()=>{ extendSession(); startAutoLogout(); }));
    startAutoLogout();

    // Dynamic page loader
    const content = document.getElementById('content');
    async function loadPage(page){
      content.innerHTML = '<div class="loading">Loading...</div>';
      try{
        const res = await fetch(page);
        if(!res.ok) throw new Error('Not found');
        const txt = await res.text();
        content.innerHTML = txt;
      }catch(e){
        content.innerHTML = `<div style="padding:2rem;color:#b00020;text-align:center">Failed to load ${page}</div>`;
      }
    }

    // Bottom nav
    document.querySelectorAll('.bottom-nav button').forEach(b=>{
      b.addEventListener('click', ()=>{
        document.querySelectorAll('.bottom-nav button').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        loadPage(b.dataset.page);
        window.scrollTo({top:0,behavior:'smooth'});
      });
    });

    // Default page
    loadPage('dashboard.html');

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem('cacao_session');
      toast('Logged out');
      setTimeout(()=> location.href='index.html', 700);
    });

    // Footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Service Worker
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
