<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cacao Drying Monitor Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; background: #fff; color: #000; display: flex; }
    .sidebar { width: 200px; background: #f5f5f5; padding-top: 1rem; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; height: 100vh; position: fixed; border-right: 1px solid #ccc; }
    .sidebar a { color: #333; text-decoration: none; padding: 1rem; width: 100%; display: flex; justify-content: center; gap: 8px; transition: background .2s; font-size: 1rem; }
    .sidebar a:hover { background: #ddd; }
    .sidebar a#logout-btn { color: #d00000; margin-top: auto; font-weight: bold; }
    .main { margin-left: 200px; padding: 2rem; flex: 1; }
    header { background: radial-gradient(circle at center, #fff, #a2d2ff, #b5ead7); color: #000; text-align: center; padding: 1.5rem; border-radius: 1rem; font-size: 1.5rem; font-weight: 600; }
    .section { margin: 1.5rem auto; padding: 1rem; background: #f9f9f9; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,.1); }
    .data-box { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 1rem; }
    .sensor-card { background: #fff; padding: 1rem; border-radius: 10px; border: 1px solid #ddd; width: 140px; text-align: center; }
    .sensor-card h3 { margin: .4rem 0; font-size: 1rem; }
    .sensor-card p  { font-size: 1.5rem; font-weight: 700; }
    canvas { max-width: 100%; height: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: .5rem; }
    th, td { border: 1px solid #ccc; padding: .4rem; text-align: center; }
    th { background: #e0e0e0; color: #000; }
    footer { text-align: center; padding: 2rem; font-size: .9rem; color: #666; }
    @media (max-width: 600px) {
      .sidebar { display: none; }
      .main { margin-left: 0; padding: 1rem; }
      .sensor-card { width: 100%; }
      .data-box { flex-direction: column; align-items: center; }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <a href="#dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
    <a href="#overview"><i class="fas fa-file-alt"></i> Overview</a>
    <a href="#data-summary" id="summary-link"><i class="fas fa-table"></i> Data&nbsp;Summary</a>
    <a href="#history"><i class="fas fa-history"></i> History</a>
    <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <div class="main">
    <header>Development and Implementation of a Wireless Monitoring System for Theobroma Cacao Drying Process</header>

    <!-- DASHBOARD -->
    <div id="dashboard">
      <div class="section">
        <div class="data-box">
          <div class="sensor-card"><h3>Temperature 1</h3><p id="temperature1">--</p></div>
          <div class="sensor-card"><h3>Temperature 2</h3><p id="temperature2">--</p></div>
          <div class="sensor-card"><h3>Temperature 3</h3><p id="temperature3">--</p></div>
          <div class="sensor-card"><h3>Moisture %</h3><p id="moisture">--</p></div>
          <div class="sensor-card"><h3>Status</h3><p id="dryingStatus">--</p></div>
          <div class="sensor-card"><h3>Weather</h3><p id="weather">--</p></div>
        </div>
      </div>
      <div class="section">
        <h3> Temperature</h3>
        <canvas id="tempChart1"></canvas>
        <canvas id="tempChart2"></canvas>
        <canvas id="tempChart3"></canvas>
      </div>
      <div class="section">
        <h3> Moisture Level</h3>
        <canvas id="moistureChart"></canvas>
      </div>
    </div>

    <!-- OVERVIEW -->
    <div id="overview" class="section">
      <h3> Thesis Overview</h3>
      <p><strong>Development and Implementation of a Wireless Monitoring System for Theobroma Cacao Drying Process</strong> uses a low-power wireless sensor network to monitor temperature, humidity, and moisture during cacao drying. Real-time data allows farmers to optimize drying conditions and improve quality.</p>
    </div>

    <!-- DATA SUMMARY -->
    <div id="data-summary" class="section">
      <h3> Daily Summary — <span id="summary-date">–</span></h3>
      <table>
        <thead><tr><th>Sensor</th><th>Min</th><th>Max</th><th>Avg</th></tr></thead>
        <tbody id="summary-table"><tr><td colspan="4">Loading summary…</td></tr></tbody>
      </table>
      <button id="export-btn">⬇️ Export CSV</button>
    </div>

    <!-- HISTORICAL VIEW -->
    <div id="history" class="section">
      <h3> Historical Data Viewer</h3>
      <input type="date" id="history-date"> <button id="load-history-btn">Load</button>
      <table id="history-table">
        <thead><tr><th>Time</th><th>Temp1</th><th>Temp2</th><th>Temp3</th><th>Moisture</th></tr></thead>
        <tbody><tr><td colspan="5">Select a date to view data…</td></tr></tbody>
      </table>
    </div>

    <footer>&copy; 2025 Cacao Drying Monitoring • Powered by ThingSpeak + Firebase</footer>
  </div>

  <!-- LIBRARIES -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js"></script>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD7v-FaTaGM6pXISZTob6-h4Y0S43hpsLk",
      authDomain: "cacao-drying-monitoring.firebaseapp.com",
      projectId: "cacao-drying-monitoring",
      storageBucket: "cacao-drying-monitoring.firebasestorage.app",
      messagingSenderId: "67538315929",
      appId: "1:67538315929:web:587e505858c50b1f49e608",
      measurementId: "G-YPTLPXQQ5V"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ThingSpeak API
    const channelID = 2770965;
    const readAPI   = "LJ902FFDJSJOBZYJ";

    // Fetch live data and save to Firebase
    async function fetchLiveData() {
      const url = `https://api.thingspeak.com/channels/${channelID}/feeds/last.json?api_key=${readAPI}`;
      const d = await (await fetch(url)).json();
      const data = {
        timestamp: new Date().toLocaleString(),
        temperature1: parseFloat(d.field1),
        temperature2: parseFloat(d.field2),
        temperature3: parseFloat(d.field3),
        moisture: parseFloat(d.field4)
      };
      // Display live
      document.getElementById("temperature1").textContent = `${data.temperature1}°C`;
      document.getElementById("temperature2").textContent = `${data.temperature2}°C`;
      document.getElementById("temperature3").textContent = `${data.temperature3}°C`;
      document.getElementById("moisture").textContent    = `${data.moisture}%`;

      // Save to Firebase
      firebase.database().ref("sensorData").push(data);
    }

    // Load history from Firebase by date
    document.getElementById("load-history-btn").addEventListener("click", async () => {
      const selectedDate = document.getElementById("history-date").value;
      if (!selectedDate) return alert("Select a date first!");
      const snapshot = await firebase.database().ref("sensorData").once("value");
      const data = snapshot.val() || {};
      const tbody = document.querySelector("#history-table tbody");
      tbody.innerHTML = "";
      Object.values(data).forEach(d => {
        if (d.timestamp.includes(selectedDate)) {
          const row = `<tr><td>${d.timestamp}</td><td>${d.temperature1}</td><td>${d.temperature2}</td><td>${d.temperature3}</td><td>${d.moisture}</td></tr>`;
          tbody.innerHTML += row;
        }
      });
      if (!tbody.innerHTML) tbody.innerHTML = `<tr><td colspan="5">No data found for ${selectedDate}</td></tr>`;
    });

    // Export CSV from Firebase
    document.getElementById("export-btn").addEventListener("click", async () => {
      const snapshot = await firebase.database().ref("sensorData").once("value");
      const data = snapshot.val() || {};
      let csv = "Timestamp,Temperature1,Temperature2,Temperature3,Moisture\n";
      Object.values(data).forEach(d => {
        csv += `${d.timestamp},${d.temperature1},${d.temperature2},${d.temperature3},${d.moisture}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "cacao_data.csv";
      link.click();
    });

    fetchLiveData();
    setInterval(fetchLiveData, 60000); // every 1 minute
  </script>
</body>
</html>


