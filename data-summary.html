<div style="padding:1rem;max-width:900px;margin:0 auto">
  <div style="background:#fff;padding:1rem;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.06);margin-bottom:1rem">
    <h2 style="color:#6b3e26;text-align:center;margin-bottom:1rem">Daily Summary</h2>
    <div style="overflow:auto">
      <table style="width:100%;border-collapse:collapse">
        <thead><tr style="background:#f1f3f5"><th style="padding:.6rem;border:1px solid #eee">Date</th><th style="padding:.6rem;border:1px solid #eee">Temp 1</th><th style="padding:.6rem;border:1px solid #eee">Temp 2</th><th style="padding:.6rem;border:1px solid #eee">Temp 3</th><th style="padding:.6rem;border:1px solid #eee">Moisture</th><th style="padding:.6rem;border:1px solid #eee">Status</th></tr></thead>
        <tbody id="summaryBody"><tr><td colspan="6" style="padding:.6rem;text-align:center">No data yet</td></tr></tbody>
      </table>
    </div>
    <div style="text-align:center;margin-top:1rem">
      <button id="exportBtn" style="padding:.6rem 1rem;border-radius:8px;border:none;background:#37b24d;color:#fff;cursor:pointer">Export CSV</button>
    </div>
  </div>

  <div style="background:#fff;padding:1rem;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.06)">
    <h2 style="text-align:center;color:#6b3e26;margin-bottom:1rem">Historical Data Viewer</h2>
    <div style="display:flex;gap:.6rem;justify-content:center;flex-wrap:wrap">
      <input id="datePicker" type="date" style="padding:.6rem;border-radius:8px;border:1px solid #ddd" />
      <button onclick="viewData()" style="padding:.6rem 1rem;border-radius:8px;border:none;background:#37b24d;color:#fff;cursor:pointer">View Data</button>
    </div>
    <div id="dataDisplay" style="text-align:center;margin-top:1rem;color:#333"></div>
  </div>
</div>

<script>
  function getHist(){ try{return JSON.parse(localStorage.getItem('cacao_history')||'[]')}catch{return[];} }
  function setHist(d){ localStorage.setItem('cacao_history', JSON.stringify(d)) }
  if(!getHist().length){ setHist([{date:'2025-10-24',t1:34,t2:33,t3:32,moisture:12,status:'Drying'}]); }
  function renderTable(){ const body=document.getElementById('summaryBody'); const d=getHist(); if(!d.length){ body.innerHTML='<tr><td colspan="6" style="padding:.6rem;text-align:center">No data</td></tr>'; return; } body.innerHTML = d.map(r=>`<tr><td style="padding:.6rem;text-align:center">${r.date}</td><td style="padding:.6rem;text-align:center">${r.t1}°C</td><td style="padding:.6rem;text-align:center">${r.t2}°C</td><td style="padding:.6rem;text-align:center">${r.t3}°C</td><td style="padding:.6rem;text-align:center">${r.moisture}%</td><td style="padding:.6rem;text-align:center">${r.status}</td></tr>`).join(''); }
  function exportCSV(){ const rows=getHist(); if(!rows.length){ alert('No data to export'); return; } const csv=['Date,Temp1,Temp2,Temp3,Moisture,Status', ...rows.map(r=>`${r.date},${r.t1},${r.t2},${r.t3},${r.moisture},${r.status}`)].join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='cacao_history.csv'; a.click(); URL.revokeObjectURL(url); }
  function viewData(){ const date=document.getElementById('datePicker').value; const disp=document.getElementById('dataDisplay'); if(!date){ disp.innerHTML="<span style='color:#b00020'>Please select a date first.</span>"; return; } const rec=getHist().find(x=>x.date===date); if(rec) disp.innerHTML=`<strong>${date}</strong> — Temp1: ${rec.t1}°C, Temp2: ${rec.t2}°C, Temp3: ${rec.t3}°C, Moisture: ${rec.moisture}%, Status: ${rec.status}`; else disp.innerHTML=`<strong>${date}</strong> — No data available.`; }
  document.getElementById('exportBtn').addEventListener('click', exportCSV); renderTable();
</script>
